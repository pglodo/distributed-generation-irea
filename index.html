<!DOCTYPE html>
<html>

<head>
  <meta charset=utf-8 />
  <title>starter template map673 module 04</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <!-- loading Assembly CSS here -->
  <link href='https://api.mapbox.com/mapbox-assembly/v0.21.2/assembly.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
  <style>

  </style>
</head>

<body>
  <!-- loading Assembly JS here -->
  <script async defer src="https://api.mapbox.com/mapbox-assembly/v0.21.2/assembly.js"></script>

  <div class='flex-parent viewport-full relative scroll-hidden'>
    <div class='flex-child w-full w300-ml absolute static-ml left bottom'>
      <div class='flex-parent flex-parent--column viewport-third h-full hmax-full bg-white py18 px12'>
        <div class='flex-child flex-child--grow px12 py12 scroll-auto'>
          <h1 class='txt-h1 mb6'>Title here</h1>
          <p>Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Sed posuere consectetur est at lobortis. Aenean eu leo quam. Pellentesque ornare sem lacinia quam venenatis vestibulum. Aenean lacinia bibendum nulla
            sed consectetur.
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.</p>
          <h2 class='txt-xl mt18 mb12'>subheading</h2>
          <p>Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Sed posuere consectetur est at lobortis. Aenean eu leo quam. Pellentesque ornare sem lacinia quam venenatis vestibulum. Aenean lacinia bibendum nulla
            sed consectetur.
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.</p>
        </div>
        <footer class='px12 py12 bg-gray-faint txt-s'>
          <ul>
            <li>Explore the raw
              <a class='link' href='#'>data</a>
            </li>
            <li>Map authored by
              <a class='link' href='#'>Ptolemy</a>
            </li>
          </ul>
        </footer>
      </div>
    </div>
    <div class='flex-child flex-child--grow viewport-twothirds viewport-full-ml'>
      <div id="map" class='viewport-twothirds viewport-full-ml'></div>

    </div>
  </div>

  <script src='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js'></script>
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
  <script>
    var map = L.map('map', {
      zoomSnap: .1,
      center: [39.4, -105],
      zoom: 9,
      minZoom: 8,
      maxZoom: 13,
      maxBounds: L.latLngBounds([37.8, -107.5], [40.9, -102.0])
    });

    // mapbox API access Token
    var accessToken = 'pk.eyJ1IjoicGdsb2RvIiwiYSI6ImNqbzU1NDFhbjAzbXIzcXB1ZTcxb3AxZzMifQ.2849K8fPe6cLYdIsrQN_8Q'

    // request a mapbox raster tile layer and add to map
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=' + accessToken, {
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
      maxZoom: 18,
      id: 'mapbox.light',
      accessToken: accessToken
    }).addTo(map);

    // paths to the CSV data
    var dataSource = ["data/distributed-generation.csv", "data/substations.csv"];

    var locationLayer = L.geoJSON(),
      substationLayer = L.geoJSON();

    for (var i = 0; i < dataSource.length; i++) {
      // if distributed generation locations
      if (i == 0) {
        omnivore.csv(dataSource[i])
          .on('ready', function(e) {
            // populate leaflet layer with data
            locationLayer.addData(e.target.toGeoJSON());
          })
          .on('error', function(e) {
            // fired if the layer can't be loaded over AJAX or can't be parsed
            console.log(e.error[0].message);
          })
      } else if (i == 1) { // if substation locations
        omnivore.csv(dataSource[i])
          .on('ready', function(e) {
            // populate leaflet layer with data
            substationLayer.addData(e.target.toGeoJSON());
          })
          .on('error', function(e) {
            // fired if the layer can't be loaded over AJAX or can't be parsed
            console.log(e.error[0].message);
          })
      }
    }

    drawMap(substationLayer, locationLayer);


    function drawMap(layer1, layer2) {

      var options = {
        pointToLayer: function(feature, ll) {
          return L.circleMarker(ll, {
            opacity: 1,
            weight: 2,
            fillOpacity: 0
          })
        }
      }

      layer1.addTo(map);
      layer2.addTo(map);
      layer1.setStyle(options);
      layer2.setStyle(options);

    } // end drawMap
  </script>


</body>

</html>
